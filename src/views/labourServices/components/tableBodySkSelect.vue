<template>  <div>  <!--查询-->  <el-dialog    title="收款人信息"    :modal-append-to-body="false"    :append-to-body="false"    :visible.sync="param.visible"  >    <el-form :rules="rules" label-position="left" inline class="demo-table-expand">      <template v-for="(item,i) in param.list">        <template v-if="item.key==='crtbank'">          <el-form-item :prop="item.key" :label="item.name">            <el-input size="small" style="width: 500px" :placeholder="item.tips" v-model="queryData[item.key]"></el-input>          </el-form-item>        </template>        <template v-if="item.type === 'yhzh'">          <el-form-item :prop="item.key" :label="item.name">            <el-input              size="small"              readonly              suffix-icon="el-icon-search"              :disabled="item.disabled"              :class="item.disabled ? 'c_no_pointer' : ''"              :placeholder="item.tips"              v-model="queryData[item.key]"              v-on:click.native="handleYhzh">            </el-input>          </el-form-item>        </template>        <template v-else-if="item.type === 'textarea'">          <el-form-item :prop="item.key" :label="item.name">            <el-input              style="width: 300px"              type="textarea"              :rows="3"              :placeholder="item.tips"              v-model="queryData[item.key]">            </el-input>          </el-form-item>        </template>        <template v-else-if="item.type === 'bank'">          <el-form-item :prop="item.key" :label="item.name">            <el-input              size="small"              :placeholder="item.tips"              v-model.number="queryData[item.key]"              @input="handleBankNum"            >            </el-input>          </el-form-item>        </template>        <template v-else-if="item.type === 'skr'">          <el-form-item :prop="item.key" :label="item.name">            <el-input              size="small"              readonly              clearable              suffix-icon="el-icon-search"              :placeholder="item.tips"              v-model="queryData[item.key]"              v-on:click.native="handleSkr"></el-input>          </el-form-item>        </template>        <template v-else-if="item.type === 'def1'">          <el-form-item :prop="item.key" :label="item.name">            <el-input              size="small"              readonly              clearable              suffix-icon="el-icon-search"              :placeholder="item.tips"              v-model="queryData[item.key]"              v-on:click.native="handleKs"></el-input>          </el-form-item>        </template>        <template v-else-if="item.type === 'def2'">          <el-form-item :prop="item.key" :label="item.name">            <el-input              size="small"              readonly              clearable              suffix-icon="el-icon-search"              :placeholder="item.tips"              v-model="queryData[item.key]"              v-on:click.native="handleKsyh"></el-input>          </el-form-item>        </template>        <template v-else>          <el-form-item :prop="item.key" :label="item.name">            <el-input size="small" clearable :disabled="item.disabled" :placeholder="item.tips" v-model="queryData[item.key]"></el-input>          </el-form-item>        </template>      </template>    </el-form>    <span slot="footer" class="dialog-footer">        <el-button size="small" @click="close">取 消</el-button>        <el-button type="primary" size="small" @click="confirmSelect">确 定</el-button>      </span>  </el-dialog>    <!--收款人选择-->    <skr-select ref="skrSelect" @confirm="confirmSkr"></skr-select>    <!--银行账号选择-->    <yhzh-select ref="yhzhSelect" @confirm="confirmYhzh"></yhzh-select>    <!--客商选择-->    <ks-select ref="ksSelect" @confirm="confirmKs"></ks-select>    <!--客商银行选择-->    <ksyh-select ref="ksyhSelect" @confirm="confirmKsyh"></ksyh-select>  </div></template><script>  import skrSelect from './skrSelect'  import yhzhSelect from './yhzhSelect'  import ksSelect from './ksSelect'  import ksyhSelect from './ksyhSelect'  export default {    name: "tableBodySkSelect",    components: { skrSelect, yhzhSelect, ksSelect, ksyhSelect },    data() {      return {        api: '',        param: {          visible: false,          type: 'add',          index: 0,          list: [            { name: '收款人', key: 'skrname', type: 'skr', tips: '请选择收款人' },            // { name: '部门', key: 'bmname', type: 'text', disabled: true, tips: '请输入部门' },            { name: '收款人银行账号', key: 'yhzhname', type: 'yhzh', tips: '请选择银行账号' },            { name: '收款客商', key: 'def1name', type: 'def1', tips: '请输入收款客商' },            { name: '客商银行账户', key: 'def2name', type: 'def2', tips: '请输入客商银行账户' },            { name: '金额', key: 'je', type: 'number', tips: '请输入金额' },            { name: '备注', key: 'skbz', type: 'textarea', tips: '请输入备注' }          ]        },        rules: {          idcard: [            { validator: this.validateIdcard, trigger: 'blur' }          ],        },        dataSource: {          idCardReg: /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/        },        queryData: {        }      }    },    watch: {    },    methods: {      open(type, api, row, index) {        this.api = api        this.type = type        this.index = index        this.queryData = row || {}        if (this.queryData.banknum) {          this.queryData.banknum =  String(this.queryData.banknum).replace(/\s/g, '');        }        this.param.visible = true      },      close() {        this.queryData = {}        this.param.visible = false      },      confirmSelect() {        let obj = this.$util.deepCopy(this.queryData);        // if (obj.banknum) {        //   obj.banknum =  obj.banknum.replace(/\s/g, '');        // }        if (!obj.skr && !obj.def1) {          let msg = '请填写收款人或收款客商'          return this.$message({ message: msg, duration: 1000 })        }        if (obj.skr && obj.def1) {          return this.$message({ message: ' 收款人和收款客商不能同时存在', duration: 1000 })        }        if (!obj.je) {          return this.$message({ message: '请填写金额', duration: 1000 })        }        // if (!obj.skbz) {        //   return this.$message({ message: '请填写备注', duration: 1000 })        // }        this.$emit('confirm', this.type, obj, this.index)        this.close()      },      // 银行卡号展示格式      handleBankNum(value) {        let nospace = value.replace(/\s/g, '')        let result = nospace.replace(/(\d{4})/g, "$1 ").trim()        this.queryData.banknum = result      },      // rules      validateIdcard(rule, value, callback) {        value = this.queryData.idcard        const reg = this.dataSource.idCardReg        if (value === '') {          callback(new Error('请输入身份证'));        } else if(!reg.test(value)){          callback(new Error('请输入正确的身份证'));        } else {          callback();        }      },      // 选择收款人+部门      handleSkr() {        this.$refs.skrSelect.open(this.api.getData)      },      // 收款人+部门 提交      confirmSkr(data) {        this.queryData = {          ...this.queryData,          // bmname: data.bmname,          // bm: data.bm,          skrname: data.skrname,          skr: data.skr,          yhzhname: undefined,          yhzh: undefined,          // 同时清空 客商          def1: undefined,          def1name: undefined,          def2: undefined,          def2name: undefined        }      },      // 银行账号      handleYhzh() {        this.$refs.yhzhSelect.open(this.api.getData, {          skr: this.queryData.skr        })      },      confirmYhzh(row) {        // accountcode: "55524488553532342121"        // accountname: "刘三江"        // pk_accbank: "1001AA10000000000AT0"        // pk_psndoc: "1004F810000000002YMG"        this.queryData = {          ...this.queryData,          yhzhname: row.accountcode,          yhzh: row.pk_accbank,        }      },      // 客商      handleKs() {        this.$refs.ksSelect.open(this.api)      },      confirmKs(row) {        this.queryData = {          ...this.queryData,          // bmname: undefined,          // bm: undefined,          skrname: undefined,          skr: undefined,          yhzhname: undefined,          yhzh: undefined,          // 银行账号 + 客商名称          def2: undefined,          def2name: undefined,          def1: row.pk,          def1name: row.name        }      },      // 客商银行账号      handleKsyh() {        if (!this.queryData.def1) {          return this.$message({ message: '请先选择客商', duration: 1000 })        }        this.$refs.ksyhSelect.open(this.api, this.queryData.def1)      },      confirmKsyh(row) {        this.queryData = {          ...this.queryData,          // 银行账号          def2: row.pk_accbank,          def2name: row.accountcode        }      },    }  }</script><style scoped></style>