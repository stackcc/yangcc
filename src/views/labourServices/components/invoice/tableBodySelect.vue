<template>  <div>  <!--查询-->  <el-dialog    title=""    :modal-append-to-body="false"    :append-to-body="false"    :visible.sync="param.visible"  >    <el-form :rules="rules" label-position="left" inline class="demo-table-expand">      <template v-for="(item,i) in param.list">        <template v-if="item.type === 'custname'">          <el-form-item :prop="item.key" :label="item.name">            <el-input              size="small"              clearable              :placeholder="item.tips"              v-model="queryData[item.key]"              v-on:change.native="handleChangeKs"            >              <el-button slot="append" icon="el-icon-search" v-on:click.native="handleKs"></el-button>            </el-input>          </el-form-item>        </template>        <template v-else-if="item.type === 'jobname'">          <el-form-item :prop="item.key" :label="item.name">            <el-input              size="small"              readonly              clearable              suffix-icon="el-icon-search"              :placeholder="item.tips"              v-model="queryData[item.key]"              v-on:click.native="handleJobname"></el-input>          </el-form-item>        </template>        <template v-else-if="item.type === 'invname'">          <el-form-item :prop="item.key" :label="item.name">            <el-input              size="small"              readonly              clearable              suffix-icon="el-icon-search"              :placeholder="item.tips"              v-model="queryData[item.key]"              v-on:click.native="handleInvname"></el-input>          </el-form-item>        </template>        <template v-else-if="item.type === 'fptype'">          <el-form-item :prop="item.key" :label="item.name">            <el-select              style="width: 100px"              size="small"              readonly              v-model="queryData[item.key]"            >              <el-option                v-for="item in dataSource.fptypeList"                :key="item.value"                :label="item.label"                :value="item.value">              </el-option>            </el-select>          </el-form-item>        </template>        <template v-else>          <el-form-item :prop="item.key" :label="item.name">            <el-input size="small" clearable :disabled="item.disabled" :placeholder="item.tips" v-model="queryData[item.key]"></el-input>          </el-form-item>        </template>      </template>    </el-form>    <span slot="footer" class="dialog-footer">        <el-button size="small" @click="close">取 消</el-button>        <el-button type="primary" size="small" @click="confirmSelect">确 定</el-button>      </span>  </el-dialog>    <!--收款人选择-->    <!--<skr-select ref="skrSelect" @confirm="confirmSkr"></skr-select>-->    <!--银行账号选择-->    <!--<yhzh-select ref="yhzhSelect" @confirm="confirmYhzh"></yhzh-select>-->    <!--客商选择-->    <ks-select ref="ksSelect" @confirm="confirmKs"></ks-select>    <!--项目选择-->    <jobname-select ref="jobnameSelect" @confirm="confirmJobname"></jobname-select>    <!--商品选择-->    <item-select ref="itemSelect" @confirm="confirmItem"></item-select>  </div></template><script>  // import skrSelect from './skrSelect'  // import yhzhSelect from './yhzhSelect'  // import ksyhSelect from '../ksyhSelect'  import ksSelect from '../ksSelect'  import jobnameSelect from '../project'  import itemSelect from './itemSelect'  export default {    name: "tableBodySkSelect",    components: { ksSelect, jobnameSelect, itemSelect },    data() {      return {        api: '',        param: {          visible: false,          type: 'add',          index: 0,          list: [            // pk_dept            { name: '申请部门', key: 'deptname', type: '', isUse: true },            { name: '到账单号', key: 'noteno', type: '', isUse: true },            // pk_jobbasdoc            { name: '项目', key: 'jobname', type: 'jobname', isUse: true },            // pk_cubasdoc            { name: '购方单位', key: 'custname', type: 'custname', isUse: true },            { name: '购方税号', key: 'taxpayerid', type: '', isUse: true },            { name: '购方开户行', key: 'bankname', type: '', isUse: true },            { name: '购方银行账户', key: 'accnum', type: '', isUse: true },            { name: '购方地址', key: 'conaddr', type: '', isUse: true },            { name: '含税单价', key: 'nmoney', type: '', isUse: true },            { name: '购方电话', key: 'phone1', type: '', isUse: true },            // pk_invbasdoc            { name: '商品名称', key: 'invname', type: 'invname', isUse: true },            { name: '规格型号', key: 'invspec', type: '', isUse: true },            { name: '数量', key: 'nnum', type: '', isUse: true },            { name: '计量单位', key: 'measname', type: '', isUse: true },            { name: '发票类型', key: 'fptype', type: 'fptype', isUse: true },            { name: '备注', key: 'memo', type: '', isUse: true }          ]        },        rules: {          idcard: [            { validator: this.validateIdcard, trigger: 'blur' }          ],        },        dataSource: {          idCardReg: /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,          // 发票类型          fptypeList: [            { value: '专', label: '专' },            { value: '普', label: '普' },            { value: '否', label: '否' }          ],        },        queryData: {        }      }    },    watch: {    },    methods: {      open(type, api, row, index) {        this.api = api        this.type = type        this.index = index        this.queryData = row || {}        // if (this.queryData.banknum) {        //   this.queryData.banknum =  String(this.queryData.banknum).replace(/\s/g, '');        // }        this.param.visible = true      },      close() {        this.queryData = {}        this.param.visible = false      },      confirmSelect() {        let obj = this.$util.deepCopy(this.queryData);        if (!obj.custname) {          return this.$message({ message: '请填写客商', duration: 1000 })        }        if (!obj.job) {          return this.$message({ message: '请选择项目', duration: 1000 })        }        if (!obj.amount) {          return this.$message({ message: '请填写金额', duration: 1000 })        }        this.$emit('confirm', this.type, obj, this.index)        this.close()      },      // 银行卡号展示格式      handleBankNum(value) {        let nospace = value.replace(/\s/g, '')        let result = nospace.replace(/(\d{4})/g, "$1 ").trim()        this.queryData.banknum = result      },      // rules      validateIdcard(rule, value, callback) {        value = this.queryData.idcard        const reg = this.dataSource.idCardReg        if (value === '') {          callback(new Error('请输入身份证'));        } else if(!reg.test(value)){          callback(new Error('请输入正确的身份证'));        } else {          callback();        }      },      // 客商      handleKs() {        this.$refs.ksSelect.open(this.api)      },      confirmKs(row) {        this.queryData = {          ...this.queryData,          cust: row.pk,          custname: row.name        }      },      handleChangeKs() {        console.log(111)        this.queryData = {          ...this.queryData,          cust: undefined        }      },      // 项目      handleJobname() {        this.$refs.jobnameSelect.open(this.api.getData)      },      confirmJobname(data) {        this.queryData = {          ...this.queryData,          jobname: data.jobname,          job: data.pk_job        }      },      // 商品      handleInvname() {        this.$refs.itemSelect.open(this.api)      },      confirmItem(row) {        this.queryData = {          ...this.queryData,          invname: row.invname,        }      },    }  }</script><style scoped></style>