<template>  <vue-easy-print tableShow ref="easyPrint" >    <div id="printModel" class="c_p_n c_box c_auto_y">      <!--<h2 class="c_center">{{ headerTableSelectionData.purpose }}</h2>-->      <div class="c_flex c_item_center">        <div style="flex: 4"><h1 class="c_center">差旅费报销单</h1></div>        <div style="flex: 1" class="c_left">          <div>合同编号： {{headerTableSelectionData.ht}}</div>          <div class="c_m_t_n">项目： {{headerTableSelectionData.xmname}}</div>        </div>      </div>      <!--其他信息-->      <div class="c_m_t_n c_flex">        <div style="flex: 2">单据编号： {{headerTableSelectionData.vbillno}}</div>        <div style="flex: 2">单据日期： {{headerTableSelectionData.dbilldate}}</div>        <div style="flex: 1">附件张数： {{headerTableSelectionData.fjzs}}</div>      </div>      <div class="to-table c_m_t_n c_flex c_item_center">        <div style="flex: 1">部门：</div>        <div style="flex: 2">{{headerTableSelectionData.bxbmname}}</div>        <div style="flex: 1">报销人：</div>        <div style="flex: 2">{{headerTableSelectionData.bxrname}}</div>        <div style="flex: 1">事由：</div>        <div style="flex: 3">{{headerTableSelectionData.sy}}</div>      </div>      <!--表体-->      <div class="c_m_t_n">        <!--新版打印-->        <el-table          style="width: 100%"          size="small"          border          show-summary          :summary-method="getSummaries_fy_new" :data="tableBodyData.fy"          cell-class-name="cus-cell"          header-cell-class-name="cus-cell"        >          <template v-for="(item, i) in tableBodyParam.list_fy_new">            <el-table-column v-if="item.key === 'rowno'" :key="i" :label="item.name" :prop="item.key">              <template slot-scope="scope">                {{ scope.$index + 1}}              </template>            </el-table-column>            <template v-else-if="item.isTitle">              <el-table-column :key="i" :label="item.name" align="center" :min-width="item.minWidth">                <template v-for="(subItem, sub) in item.children">                  <el-table-column :key="i + '-' + sub" :min-width="subItem.minWidth" :label="subItem.name" :prop="subItem.key"></el-table-column>                </template>              </el-table-column>            </template>            <el-table-column v-else :key="i" :min-width="item.minWidth" :width="item.width" :label="item.name" :prop="item.key"></el-table-column>          </template>        </el-table>      </div>      <div style="height: 1px; background: #000"></div>      <div class="to-table c_m_t_n c_flex c_item_center">        <div style="flex: 1">报销总计: {{ headerTableSelectionData.bxje }}</div>        <div style="flex: 6; text-align: center">{{ headerTableSelectionData.totalSkToCap }} </div>        <div style="flex: 1; text-align: center">¥</div>        <div style="flex: 2; text-align: center">{{ headerTableSelectionData.totalSk || 0 }} </div>      </div>      <!--收款信息-->      <div class="c_m_t_n">        <el-table          class="c_h"          border          size="small"          max-height="300"          show-summary          :summary-method="getSummaries_sk"          :data="tableBodyData.sk"          cell-class-name="cus-cell"          header-cell-class-name="cus-cell"        >          <template v-for="(item, i) in tableBodyParam.list_sk">            <el-table-column v-if="item.key === 'rowno'" :key="i" :label="item.name" :prop="item.key">              <template slot-scope="scope">                {{ scope.$index + 1}}              </template>            </el-table-column>            <el-table-column v-else :key="i" :width="item.width" :label="item.name" :prop="item.key"></el-table-column>          </template>        </el-table>      </div>      <div style="height: 1px; background: #000"></div>      <!--其他信息-->      <div class="c_m_t_n c_flex c_item_center">        <div style="flex: 1.6">部门负责人： </div>        <div style="flex: 1.6">财务审核人： </div>        <div style="flex: 1.6">财务负责人： </div>        <div style="flex: 1.6">分管副院长： </div>        <div style="flex: 1.6">院长： </div>        <div style="flex: 1.6">报销人： </div>      </div>      <div class="c_m_t_20 c_flex c_item_center">        <div style="flex: 9">本人承诺所附单据真实合法有效！ </div>        <div style="flex: 1">承诺人： </div>      </div>    </div>  </vue-easy-print></template><script>  import vueEasyPrint from "vue-easy-print";  export default {    name: "printTravelExpenses",    components: { vueEasyPrint },    data() {      return {        visible: true,        // 表体参数        // -- 表格参数        tableBodyParam: {          list: [],          // 收款人信息: sk          list_sk: [            { name: '收款人', key: 'skrname', isUse: true },            { name: '收款人银行账号', key: 'yhzhname', isUse: true },            { name: '收款客商', key: 'def1name', isUse: true },            { name: '客商银行账号', key: 'def2name', isUse: true },            { name: '金额(元)', key: 'je', isUse: true },            { name: '备注', key: 'skbz', isUse: true }          ],          // 差旅报销单-新版 2021-5-10          list_fy_new: [            { name: '出发日期', key: 'ccrq', minWidth: '50', width: 110, isUse: true },            { name: '到达日期', key: 'def3', minWidth: '50', width: 110, isUse: true },            { name: '起止地点', isTitle: true, children: [                { name: '出发地点', key: 'cfdd', minWidth: '50', isUse: true },                { name: '到达地点', key: 'dddd', minWidth: '50', isUse: true }              ]            },            { name: '费用明细', isTitle: true, children: [                { name: '交通工具', key: 'jtgj', minWidth: '50', width: 60, isUse: true },                { name: '城市间交通费', key: 'jtf', minWidth: '50', width: 70, isUse: true },                { name: '市内交通费', key: 'snjtf', minWidth: '50', width: 70, isUse: true },                { name: '伙食补助', key: 'hsbz', minWidth: '40', width: 70, isUse: true },                { name: '住宿费', key: 'zsf', minWidth: '30', width: 70, isUse: true },                { name: '其他费用', key: 'qtje', minWidth: '40', width: 70, isUse: true }              ]            },            { name: '备注', key: 'fymemo', minWidth: '40', isUse: true }          ]        },        headerTableSelectionData: {},        // -- 表格列表数据        tableBodyData: {          // 收款人信息          sk: [],          // 费用明细          fy: []        },      }    },    created() {      // this.tableBodyData = JSON.parse(this.$route.query.tableBodyData);      // this.headerTableSelectionData = JSON.parse(this.$route.query.headerTableSelectionData);      let tableBodyData = sessionStorage['tableBodyData']      let headerTableSelectionData = sessionStorage['headerTableSelectionData']      this.tableBodyData = JSON.parse(tableBodyData);      this.headerTableSelectionData = JSON.parse(headerTableSelectionData);      // 金额大写      this.headerTableSelectionData.totalSkToCap = this.$util.changeNumMoneyToChinese(this.headerTableSelectionData.totalSk)    },    mounted() {      // window.print();//调用打印的窗口      this.printView()    },    methods: {      open(tableBodyData, headerTableSelectionData) {        this.tableBodyData = tableBodyData;        this.headerTableSelectionData = headerTableSelectionData;        this.visible = true      },      cancel() {        this.tableBodyData = [];        this.headerTableSelectionData = {};        this.visible = false      },      // 表体合计: sk：收款人信息， fy：费用      getSummaries_sk(param) {        const { columns, data } = param;        const sums = [];        columns.forEach((column, index) => {          if (index === 0) {            sums[index] = '合计';            return;          }          if (![4].includes(index)) {            return;          }          const values = data.map(item => Number(item[column.property]));          if (!values.every(value => isNaN(value))) {            sums[index] = values.reduce((prev, curr) => {              const value = Number(curr);              if (!isNaN(value)) {                return prev + curr;              } else {                return prev;              }            }, 0);            sums[index] = +(sums[index].toFixed(2))            sums[index] += ' 元';          } else {            sums[index] = '';          }        });        return sums;      },      getSummaries_fy(param) {        const { columns, data } = param;        const sums = [];        columns.forEach((column, index) => {          if (index === 0) {            sums[index] = '合计';            return;          }          if (![5, 7, 8, 10, 11, 12, 13, 15, 16, 17].includes(index)) {            return;          }          const values = data.map(item => Number(item[column.property]));          if (!values.every(value => isNaN(value))) {            sums[index] = values.reduce((prev, curr) => {              const value = Number(curr);              if (!isNaN(value)) {                return prev + curr;              } else {                return prev;              }            }, 0);            sums[index] = +(sums[index].toFixed(4))            sums[index] += ' 元';          } else {            sums[index] = '';          }        });        return sums;      },      getSummaries_fy_new(param) {        const { columns, data } = param;        const sums = [];        columns.forEach((column, index) => {          if (index === 0) {            sums[index] = '小计';            return;          }          if (![4, 5, 6, 7, 8].includes(index)) {            return;          }          const values = data.map(item => Number(item[column.property]));          if (!values.every(value => isNaN(value))) {            sums[index] = values.reduce((prev, curr) => {              const value = Number(curr);              if (!isNaN(value)) {                return prev + curr;              } else {                return prev;              }            }, 0);            sums[index] = +(sums[index].toFixed(4))            sums[index] += ' 元';          } else {            sums[index] = '';          }        });        return sums;      },      // 打印      printView() {        this.$nextTick(() => {          this.$refs.easyPrint.print()        })      }    }  }</script><style scoped>.to-table{  border:1px solid #e3e3e3 ;}.to-table div{  height: 100%;  padding: 12px 10px;  min-width: 0;  box-sizing: border-box;  text-overflow: ellipsis;  vertical-align: middle;  text-align: left;  border-left:1px solid #ebeef5 ;  margin-left: -1px;}  /*>>> .cus-cell{*/    /*border: 1px solid #e3e3e3 !important;*/  /*}*/#printModel >>> *::-webkit-scrollbar{  display: none;}#printModel >>> * {  border-color: #000 !important;  border-top-color: #000 !important;  border-bottom-color: #000 !important;  border-right-color: #000 !important;  border-left-color: #000 !important;  border-width: 2px !important;  overflow: auto !important;  overflow: -moz-scrollbars-none;}</style>